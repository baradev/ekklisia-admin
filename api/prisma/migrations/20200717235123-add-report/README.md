# Migration `20200717235123-add-report`

This migration has been generated by nampdn at 7/17/2020, 11:51:23 PM.
You can check out the [state of the schema](./schema.prisma) after the migration.

## Database Steps

```sql
CREATE TABLE `ekklisia`.`ReportQuestion` (
`content` varchar(191) NOT NULL  ,`id` varchar(191) NOT NULL ,`type` varchar(191) NOT NULL  ,
    PRIMARY KEY (`id`)
) DEFAULT CHARACTER SET utf8mb4 COLLATE utf8mb4_unicode_ci

CREATE TABLE `ekklisia`.`ReportCampaign` (
`date` datetime(3) NOT NULL  ,`id` varchar(191) NOT NULL ,
    PRIMARY KEY (`id`)
) DEFAULT CHARACTER SET utf8mb4 COLLATE utf8mb4_unicode_ci

CREATE TABLE `ekklisia`.`ReportInGroup` (
`id` varchar(191) NOT NULL ,
    PRIMARY KEY (`id`)
) DEFAULT CHARACTER SET utf8mb4 COLLATE utf8mb4_unicode_ci

CREATE UNIQUE INDEX `ReportCampaign_id` ON `ekklisia`.`ReportCampaign`(`id`)

ALTER TABLE `ekklisia`.`ReportQuestion` ADD FOREIGN KEY (`id`) REFERENCES `ekklisia`.`ReportCampaign`(`id`) ON DELETE CASCADE ON UPDATE CASCADE

ALTER TABLE `ekklisia`.`ReportCampaign` ADD FOREIGN KEY (`id`) REFERENCES `ekklisia`.`ReportInGroup`(`id`) ON DELETE CASCADE ON UPDATE CASCADE

ALTER TABLE `ekklisia`.`ReportInGroup` ADD FOREIGN KEY (`id`) REFERENCES `ekklisia`.`Group`(`id`) ON DELETE CASCADE ON UPDATE CASCADE

DROP TABLE `ekklisia`.`Report`;

DROP TABLE `ekklisia`.`ReportQuest`;
```

## Changes

```diff
diff --git schema.prisma schema.prisma
migration 20200707000055-initial-deploy..20200717235123-add-report
--- datamodel.dml
+++ datamodel.dml
@@ -1,7 +1,7 @@
 datasource DS {
   provider = "mysql"
-  url = "***"
+  url = "***"
 }
 generator client {
   provider      = "prisma-client-js"
@@ -44,24 +44,25 @@
   enrollment   GroupEnrollment[]
 }
 model Group {
-  id          String            @default(cuid()) @id
-  name        String
-  slug        String?           @unique
-  year        Int?
-  stage       String?
-  members     Profile[]         @relation("GroupMembers", references: [id])
-  startAt     DateTime?
-  endAt       DateTime?
-  createdAt   DateTime          @default(now())
-  updatedAt   DateTime          @updatedAt @default(now())
-  leader      Profile?          @relation("GroupLeader", fields: [leaderId], references: [id])
-  leaderId    String?
-  org         Org?              @relation(fields: [orgId], references: [id])
-  orgId       String?
-  attendances Attendance[]      @relation("AttendanceGroup")
-  enrollment  GroupEnrollment[]
+  id            String            @default(cuid()) @id
+  name          String
+  slug          String?           @unique
+  year          Int?
+  stage         String?
+  members       Profile[]         @relation("GroupMembers", references: [id])
+  startAt       DateTime?
+  endAt         DateTime?
+  createdAt     DateTime          @default(now())
+  updatedAt     DateTime          @updatedAt @default(now())
+  leader        Profile?          @relation("GroupLeader", fields: [leaderId], references: [id])
+  leaderId      String?
+  org           Org?              @relation(fields: [orgId], references: [id])
+  orgId         String?
+  attendances   Attendance[]      @relation("AttendanceGroup")
+  enrollment    GroupEnrollment[]
+  ReportInGroup ReportInGroup[]   @relation("ReportGroup")
 }
 model GroupEnrollment {
   createdAt DateTime @default(now())
@@ -113,11 +114,23 @@
   groupId    String
   scheduleId String
 }
-model ReportQuest {
-  id String @default(cuid()) @id
+model ReportQuestion {
+  id       String         @default(cuid()) @id
+  type     String
+  content  String
+  campaign ReportCampaign @relation("ReportCampaignQuestions", fields: [id], references: [id])
 }
-model Report {
-  id String @default(cuid()) @id
+model ReportCampaign {
+  id        String           @default(cuid()) @id
+  date      DateTime
+  questions ReportQuestion[] @relation("ReportCampaignQuestions")
+  report    ReportInGroup    @relation("ReportCampaign", fields: [id])
 }
+
+model ReportInGroup {
+  id       String         @default(cuid()) @id
+  group    Group          @relation("ReportGroup", fields: [id])
+  campaign ReportCampaign @relation("ReportCampaign")
+}
```


