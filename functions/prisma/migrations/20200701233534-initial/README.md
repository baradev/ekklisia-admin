# Migration `20200701233534-initial`

This migration has been generated by nampdn at 7/1/2020, 11:35:35 PM.
You can check out the [state of the schema](./schema.prisma) after the migration.

## Database Steps

```sql
CREATE TABLE "public"."User" (
"email" text  NOT NULL ,"id" text  NOT NULL ,"name" text   ,"password" text  NOT NULL ,"permission" integer  NOT NULL ,"profileId" text  NOT NULL ,
    PRIMARY KEY ("id"))

CREATE TABLE "public"."Profile" (
"birthday" timestamp(3)   ,"createdAt" timestamp(3)  NOT NULL DEFAULT CURRENT_TIMESTAMP,"dayOfBirth" integer   ,"email" text   ,"facebookId" text   ,"fullName" text  NOT NULL ,"gender" text   ,"id" text  NOT NULL ,"joinDate" timestamp(3)   ,"monthOfBirth" integer   ,"oldId" text   ,"orgId" text   ,"phoneNumber" text   ,"slug" text   ,"updatedAt" timestamp(3)  NOT NULL ,"yearOfBirth" integer   ,
    PRIMARY KEY ("id"))

CREATE TABLE "public"."Group" (
"createdAt" timestamp(3)  NOT NULL DEFAULT CURRENT_TIMESTAMP,"endAt" timestamp(3)   ,"id" text  NOT NULL ,"leaderId" text   ,"name" text  NOT NULL ,"orgId" text   ,"slug" text   ,"stage" text   ,"startAt" timestamp(3)   ,"updatedAt" timestamp(3)  NOT NULL DEFAULT CURRENT_TIMESTAMP,"year" integer   ,
    PRIMARY KEY ("id"))

CREATE TABLE "public"."GroupEnrollment" (
"createdAt" timestamp(3)  NOT NULL DEFAULT CURRENT_TIMESTAMP,"groupId" text  NOT NULL ,"profileId" text  NOT NULL ,"updatedAt" timestamp(3)  NOT NULL ,
    PRIMARY KEY ("groupId","profileId"))

CREATE TABLE "public"."Org" (
"id" text  NOT NULL ,"name" text  NOT NULL ,
    PRIMARY KEY ("id"))

CREATE TABLE "public"."Activity" (
"color" text   ,"id" text  NOT NULL ,"name" text  NOT NULL ,"orgId" text  NOT NULL ,"slug" text  NOT NULL ,
    PRIMARY KEY ("id"))

CREATE TABLE "public"."Schedule" (
"activityId" text  NOT NULL ,"date" timestamp(3)  NOT NULL ,"id" text  NOT NULL ,
    PRIMARY KEY ("id"))

CREATE TABLE "public"."Attendance" (
"createdAt" timestamp(3)  NOT NULL DEFAULT CURRENT_TIMESTAMP,"groupId" text  NOT NULL ,"id" text  NOT NULL ,"scheduleId" text  NOT NULL ,"slug" text  NOT NULL ,"status" text  NOT NULL ,"updatedAt" timestamp(3)  NOT NULL ,
    PRIMARY KEY ("id"))

CREATE TABLE "public"."ReportQuest" (
"id" text  NOT NULL ,
    PRIMARY KEY ("id"))

CREATE TABLE "public"."Report" (
"id" text  NOT NULL ,
    PRIMARY KEY ("id"))

CREATE TABLE "public"."_GroupMembers" (
"A" text  NOT NULL ,"B" text  NOT NULL )

CREATE TABLE "public"."_AttendanceAttendee" (
"A" text  NOT NULL ,"B" text  NOT NULL )

CREATE TABLE "public"."_AttendanceAbsentee" (
"A" text  NOT NULL ,"B" text  NOT NULL )

CREATE UNIQUE INDEX "User.email" ON "public"."User"("email")

CREATE UNIQUE INDEX "Profile.oldId" ON "public"."Profile"("oldId")

CREATE UNIQUE INDEX "Profile.slug" ON "public"."Profile"("slug")

CREATE UNIQUE INDEX "Group.slug" ON "public"."Group"("slug")

CREATE UNIQUE INDEX "Activity.slug" ON "public"."Activity"("slug")

CREATE UNIQUE INDEX "Attendance.slug" ON "public"."Attendance"("slug")

CREATE UNIQUE INDEX "_GroupMembers_AB_unique" ON "public"."_GroupMembers"("A","B")

CREATE  INDEX "_GroupMembers_B_index" ON "public"."_GroupMembers"("B")

CREATE UNIQUE INDEX "_AttendanceAttendee_AB_unique" ON "public"."_AttendanceAttendee"("A","B")

CREATE  INDEX "_AttendanceAttendee_B_index" ON "public"."_AttendanceAttendee"("B")

CREATE UNIQUE INDEX "_AttendanceAbsentee_AB_unique" ON "public"."_AttendanceAbsentee"("A","B")

CREATE  INDEX "_AttendanceAbsentee_B_index" ON "public"."_AttendanceAbsentee"("B")

ALTER TABLE "public"."User" ADD FOREIGN KEY ("profileId")REFERENCES "public"."Profile"("id") ON DELETE CASCADE  ON UPDATE CASCADE

ALTER TABLE "public"."Profile" ADD FOREIGN KEY ("orgId")REFERENCES "public"."Org"("id") ON DELETE SET NULL  ON UPDATE CASCADE

ALTER TABLE "public"."Group" ADD FOREIGN KEY ("leaderId")REFERENCES "public"."Profile"("id") ON DELETE SET NULL  ON UPDATE CASCADE

ALTER TABLE "public"."Group" ADD FOREIGN KEY ("orgId")REFERENCES "public"."Org"("id") ON DELETE SET NULL  ON UPDATE CASCADE

ALTER TABLE "public"."GroupEnrollment" ADD FOREIGN KEY ("groupId")REFERENCES "public"."Group"("id") ON DELETE CASCADE  ON UPDATE CASCADE

ALTER TABLE "public"."GroupEnrollment" ADD FOREIGN KEY ("profileId")REFERENCES "public"."Profile"("id") ON DELETE CASCADE  ON UPDATE CASCADE

ALTER TABLE "public"."Activity" ADD FOREIGN KEY ("orgId")REFERENCES "public"."Org"("id") ON DELETE CASCADE  ON UPDATE CASCADE

ALTER TABLE "public"."Schedule" ADD FOREIGN KEY ("activityId")REFERENCES "public"."Activity"("id") ON DELETE CASCADE  ON UPDATE CASCADE

ALTER TABLE "public"."Attendance" ADD FOREIGN KEY ("groupId")REFERENCES "public"."Group"("id") ON DELETE CASCADE  ON UPDATE CASCADE

ALTER TABLE "public"."Attendance" ADD FOREIGN KEY ("scheduleId")REFERENCES "public"."Schedule"("id") ON DELETE CASCADE  ON UPDATE CASCADE

ALTER TABLE "public"."_GroupMembers" ADD FOREIGN KEY ("A")REFERENCES "public"."Group"("id") ON DELETE CASCADE  ON UPDATE CASCADE

ALTER TABLE "public"."_GroupMembers" ADD FOREIGN KEY ("B")REFERENCES "public"."Profile"("id") ON DELETE CASCADE  ON UPDATE CASCADE

ALTER TABLE "public"."_AttendanceAttendee" ADD FOREIGN KEY ("A")REFERENCES "public"."Attendance"("id") ON DELETE CASCADE  ON UPDATE CASCADE

ALTER TABLE "public"."_AttendanceAttendee" ADD FOREIGN KEY ("B")REFERENCES "public"."Profile"("id") ON DELETE CASCADE  ON UPDATE CASCADE

ALTER TABLE "public"."_AttendanceAbsentee" ADD FOREIGN KEY ("A")REFERENCES "public"."Attendance"("id") ON DELETE CASCADE  ON UPDATE CASCADE

ALTER TABLE "public"."_AttendanceAbsentee" ADD FOREIGN KEY ("B")REFERENCES "public"."Profile"("id") ON DELETE CASCADE  ON UPDATE CASCADE
```

## Changes

```diff
diff --git schema.prisma schema.prisma
migration ..20200701233534-initial
--- datamodel.dml
+++ datamodel.dml
@@ -1,0 +1,123 @@
+generator client {
+  provider      = "prisma-client-js"
+  binaryTargets = ["native", "rhel-openssl-1.0.x"]
+}
+
+datasource db {
+  provider = "postgresql"
+  url = "***"
+}
+
+model User {
+  id         String  @default(cuid()) @id
+  email      String  @unique
+  password   String
+  permission Int
+  name       String?
+  profile    Profile @relation("UserProfile", fields: [profileId], references: [id])
+  profileId  String
+}
+
+model Profile {
+  id           String            @default(cuid()) @id
+  fullName     String
+  gender       String?
+  oldId        String?           @unique
+  slug         String?           @unique
+  email        String?
+  facebookId   String?
+  phoneNumber  String?
+  birthday     DateTime?
+  joinDate     DateTime?
+  dayOfBirth   Int?
+  monthOfBirth Int?
+  yearOfBirth  Int?
+  org          Org?              @relation("ProfileOrg", fields: [orgId], references: [id])
+  createdAt    DateTime          @default(now())
+  updatedAt    DateTime          @updatedAt
+  leader       Group[]           @relation("GroupLeader")
+  member       Group[]           @relation("GroupMembers", references: [id])
+  attendee     Attendance[]      @relation("AttendanceAttendee", references: [id])
+  absentee     Attendance[]      @relation("AttendanceAbsentee", references: [id])
+  orgId        String?
+  user         User[]            @relation("UserProfile")
+  enrollment   GroupEnrollment[]
+}
+
+model Group {
+  id          String            @default(cuid()) @id
+  name        String
+  slug        String?           @unique
+  year        Int?
+  stage       String?
+  members     Profile[]         @relation("GroupMembers", references: [id])
+  startAt     DateTime?
+  endAt       DateTime?
+  createdAt   DateTime          @default(now())
+  updatedAt   DateTime          @updatedAt @default(now())
+  leader      Profile?          @relation("GroupLeader", fields: [leaderId], references: [id])
+  leaderId    String?
+  org         Org?              @relation(fields: [orgId], references: [id])
+  orgId       String?
+  attendances Attendance[]      @relation("AttendanceGroup")
+  enrollment  GroupEnrollment[]
+}
+
+model GroupEnrollment {
+  createdAt DateTime @default(now())
+  updatedAt DateTime @updatedAt
+  group     Group    @relation(fields: [groupId], references: [id])
+  profile   Profile  @relation(fields: [profileId], references: [id])
+  groupId   String
+  profileId String
+
+  @@id([groupId, profileId])
+}
+
+model Org {
+  id         String     @default(cuid()) @id
+  name       String
+  groups     Group[]
+  activities Activity[] @relation("OrgActivity")
+  Profile    Profile[]  @relation("ProfileOrg")
+}
+
+model Activity {
+  id       String     @default(cuid()) @id
+  slug     String     @unique
+  name     String
+  color    String?
+  org      Org        @relation("OrgActivity", fields: [orgId], references: [id])
+  orgId    String
+  Schedule Schedule[] @relation("ScheduleActivity")
+}
+
+model Schedule {
+  id          String       @default(cuid()) @id
+  attendances Attendance[] @relation("AttendanceSchedule")
+  date        DateTime
+  activity    Activity     @relation("ScheduleActivity", fields: [activityId], references: [id])
+  activityId  String
+}
+
+model Attendance {
+  id         String    @default(cuid()) @id
+  slug       String    @unique
+  status     String
+  createdAt  DateTime  @default(now())
+  updatedAt  DateTime  @updatedAt
+  group      Group     @relation("AttendanceGroup", fields: [groupId], references: [id])
+  schedule   Schedule  @relation("AttendanceSchedule", fields: [scheduleId], references: [id])
+  attendees  Profile[] @relation("AttendanceAttendee", references: [id])
+  absentees  Profile[] @relation("AttendanceAbsentee", references: [id])
+  groupId    String
+  scheduleId String
+}
+
+model ReportQuest {
+  id String @default(cuid()) @id
+}
+
+model Report {
+  id String @default(cuid()) @id
+}
```


